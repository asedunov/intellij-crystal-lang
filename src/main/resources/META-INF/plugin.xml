<idea-plugin>
    <id>intellij-crystal-lang</id>
    <name>Crystal</name>
    <vendor email="alexey.sedunov@gmail.com">Alexey Sedunov</vendor>

    <description><![CDATA[Adds support of the Crystal language:
    <ul>
      <li>Syntax highlighting</li>
      <li>Basic formatting support</li>
      <li>File structure view</li>
      <li>Go to Class/Go to Symbol navigation</li>
      <li>Find Usages</li>
      <li>Rename</li>
      <li>Completion</li>
    </ul>]]></description>

    <change-notes><![CDATA[
    <h2>New features</h2>
    <ul>
      <li><a href="https://github.com/asedunov/intellij-crystal-lang/issues/32">#32</a> Crystal 1.7 support</li>
      <li>New quickfixes:</li>
      <ul>
        <li><a href="https://github.com/asedunov/intellij-crystal-lang/issues/33">#33</a> Upgrade language level when some feature is available in newer version</li>
        <li><a href="https://github.com/asedunov/intellij-crystal-lang/issues/34">#34</a> Add missing space in type restrictions</li>
        <li><a href="https://github.com/asedunov/intellij-crystal-lang/issues/35">#35</a> Convert named tuples with constructor type into hash literals</li>
        <li><a href="https://github.com/asedunov/intellij-crystal-lang/issues/36">#36</a> Remove call arguments and parameters at improper positions</li>
      </ul>
    </ul>]]></change-notes>

    <depends>com.intellij.modules.platform</depends>

    <extensions defaultExtensionNs="com.intellij">
        <fileType name="Crystal"
                  language="Crystal"
                  implementationClass="org.crystal.intellij.CrystalFileType"
                  fieldName="INSTANCE"
                  extensions="cr"/>
        <lang.parserDefinition language="Crystal"
                               implementationClass="org.crystal.intellij.parser.CrystalParserDefinition"/>

        <internalFileTemplate name="Crystal File"/>

        <highlightingPassFactory implementation="org.crystal.intellij.highlighter.CrystalSyntaxHighlightingPass$Factory"/>
        <highlightingPassFactory implementation="org.crystal.intellij.highlighter.CrystalSyntaxCheckingPass$Factory"/>
        <highlightingPassFactory implementation="org.crystal.intellij.highlighter.CrystalResolveCheckingPass$Factory"/>

        <lang.psiStructureViewFactory language="Crystal"
                                      implementationClass="org.crystal.intellij.structure.CrystalStructureViewFactory"/>
        <lang.commenter language="Crystal" implementationClass="org.crystal.intellij.editor.CrystalCommenter"/>
        <lang.foldingBuilder language="Crystal" implementationClass="org.crystal.intellij.editor.CrystalFoldingBuilder"/>
        <lang.elementManipulator forClass="org.crystal.intellij.psi.CrStringLiteralExpression"
                                 implementationClass="org.crystal.intellij.psi.CrStringLiteralManipulator"/>

        <typedHandler implementation="org.crystal.intellij.editor.CrystalTypedHandler"
                      order="before selectionQuoting" />
        <backspaceHandlerDelegate implementation="org.crystal.intellij.editor.CrystalBackspaceHandler"/>
        <enterHandlerDelegate implementation="org.crystal.intellij.editor.CrystalEnterHandler"/>

        <langCodeStyleSettingsProvider implementation="org.crystal.intellij.formatter.CrystalCodeStyleSettingsProvider"/>
        <lang.formatter language="Crystal"
                        implementationClass="org.crystal.intellij.formatter.CrystalFormattingModelBuilder"/>
        <formattingService implementation="org.crystal.intellij.formatter.CrystalToolFormattingService"/>

        <projectService serviceImplementation="org.crystal.intellij.config.CrystalProjectSettings"/>
        <projectService serviceImplementation="org.crystal.intellij.config.CrystalProjectWorkspaceSettings"/>
        <projectService serviceImplementation="org.crystal.intellij.psi.CrPsiFactory"/>
        <projectService serviceImplementation="org.crystal.intellij.resolve.CrResolveFacade"/>

        <projectConfigurable id="crystal.settings"
                             groupId="language"
                             instance="org.crystal.intellij.config.CrystalSettingsConfigurable"/>

        <filePropertyPusher implementation="org.crystal.intellij.config.CrystalLanguageLevelPusher"/>

        <iconProvider implementation="org.crystal.intellij.presentation.CrystalIconProvider"/>
        <!--suppress PluginXmlValidity -->
        <lang.symbolDocumentation implementation="org.crystal.intellij.presentation.CrSymbolDocumentationTargetProvider"/>

        <elementDescriptionProvider implementation="org.crystal.intellij.presentation.CrystalElementDescriptionProvider"/>

        <stubElementTypeHolder class="org.crystal.intellij.stubs.elementTypes.CrStubElementTypes"/>
        <stubIndex implementation="org.crystal.intellij.stubs.indexes.CrystalTypeShortNameIndex"/>
        <stubIndex implementation="org.crystal.intellij.stubs.indexes.CrystalFunctionShortNameIndex"/>
        <stubIndex implementation="org.crystal.intellij.stubs.indexes.CrystalVariableShortNameIndex"/>
        <stubIndex implementation="org.crystal.intellij.stubs.indexes.CrystalStrictConstantShortNameIndex"/>
        <stubIndex implementation="org.crystal.intellij.stubs.indexes.CrystalConstantFqNameIndex"/>
        <stubIndex implementation="org.crystal.intellij.stubs.indexes.CrystalConstantParentFqNameIndex"/>
        <stubIndex implementation="org.crystal.intellij.stubs.indexes.CrystalTypeBySuperclassNameIndex"/>
        <stubIndex implementation="org.crystal.intellij.stubs.indexes.CrystalIncludeLikeByContainerFqNameIndex"/>
        <stubIndex implementation="org.crystal.intellij.stubs.indexes.CrystalMacroFqNameIndex"/>
        <stubIndex implementation="org.crystal.intellij.stubs.indexes.CrystalMacroSignatureIndex"/>

        <additionalLibraryRootsProvider implementation="org.crystal.intellij.sdk.CrystalSdkLibraryRootProvider"/>

        <gotoClassContributor implementation="org.crystal.intellij.navigation.CrystalGotoClassContributor"/>
        <gotoSymbolContributor implementation="org.crystal.intellij.navigation.CrystalGotoSymbolContributor"/>

        <symbolNavigation forClass="org.crystal.intellij.resolve.symbols.CrSym"
                          implementationClass="org.crystal.intellij.navigation.CrSymbolNavigationProvider"/>

        <targetElementEvaluator language="Crystal"
                                implementationClass="org.crystal.intellij.navigation.CrystalTargetElementEvaluator"/>

        <codeInsight.lineMarkerProvider language="Crystal"
                                        implementationClass="org.crystal.intellij.lineMarkers.CrystalInheritorsLineMarkerProvider"/>
        <codeInsight.lineMarkerProvider language="Crystal"
                                        implementationClass="org.crystal.intellij.lineMarkers.CrystalMacroOverrideLineMarkerProvider"/>

        <typeHierarchyProvider language="Crystal"
                               implementationClass="org.crystal.intellij.hierarchy.types.CrystalTypeHierarchyProvider"/>

        <lang.codeReferenceSearcher implementation="org.crystal.intellij.search.CrystalCodeReferenceSearcher"/>

        <searcher forClass="com.intellij.find.usages.api.UsageSearchParameters"
                  implementationClass="org.crystal.intellij.findUsages.CrystalUsageSearcher"/>
        <lang.symbolSearchTarget forClass="org.crystal.intellij.resolve.symbols.CrSym"
                                 implementationClass="org.crystal.intellij.findUsages.CrystalSymbolSearchTargetFactory"/>
        <fileStructureGroupRuleProvider implementation="org.crystal.intellij.findUsages.CrystalDeclarationGroupingRuleProvider$ByType"/>
        <fileStructureGroupRuleProvider implementation="org.crystal.intellij.findUsages.CrystalDeclarationGroupingRuleProvider$ByFunction"/>

        <completion.contributor language="Crystal"
                                implementationClass="org.crystal.intellij.completion.CrKeywordCompletionContributor"
                                id="CrKeywordCompletionContributor"
                                order="first"/>
        <completion.contributor language="Crystal"
                                implementationClass="org.crystal.intellij.completion.CrPathReferenceCompletionContributor"
                                id="CrPathReferenceCompletionContributor"/>

        <localInspection language="Crystal"
                         shortName="CrystalResolveInspection"
                         suppressId="CrystalResolve"
                         bundle="messages.CrystalBundle"
                         key="inspections.resolve.name"
                         groupKey="inspections.group"
                         enabledByDefault="true"
                         level="ERROR"
                         implementationClass="org.crystal.intellij.inspections.CrystalResolveInspection"/>

        <localInspection language="Crystal"
                         shortName="CrystalMissingMainFileInspection"
                         suppressId="CrystalMissingMainFile"
                         bundle="messages.CrystalBundle"
                         key="inspections.missing.main"
                         groupKey="inspections.group"
                         enabledByDefault="true"
                         level="WARNING"
                         implementationClass="org.crystal.intellij.inspections.CrystalMissingMainFileInspection"/>

        <renameHandler implementation="org.crystal.intellij.refactoring.rename.CrystalRenameHandler"/>
        <vetoRenameCondition implementation="org.crystal.intellij.refactoring.rename.CrystalVetoRenameCondition"/>
        <rename.symbolRenameTargetFactory implementation="org.crystal.intellij.refactoring.rename.CrystalSymbolRenameTargetFactory"/>
        <searcher forClass="com.intellij.refactoring.rename.api.RenameUsageSearchParameters"
                  implementationClass="org.crystal.intellij.refactoring.rename.CrystalRenameUsageSearcher"/>

        <configurationType implementation="org.crystal.intellij.run.CrystalFileRunConfigurationType"/>
        <runConfigurationProducer implementation="org.crystal.intellij.run.CrystalFileRunConfigurationProducer"/>
    </extensions>

    <extensionPoints>
        <extensionPoint qualifiedName="org.crystal.classInheritorsSearch"
                        interface="com.intellij.util.QueryExecutor"
                        dynamic="true"/>
        <extensionPoint qualifiedName="org.crystal.overridingMacroSearch"
                        interface="com.intellij.util.QueryExecutor"
                        dynamic="true"/>
    </extensionPoints>

    <extensions defaultExtensionNs="org.crystal">
        <classInheritorsSearch implementation="org.crystal.intellij.search.CrystalInheritorsSearcher"/>
        <overridingMacroSearch implementation="org.crystal.intellij.search.CrystalOverridingMacroSearcher"/>
    </extensions>

    <actions>
        <action id="Crystal.NewCrystalFile"
                class="org.crystal.intellij.actions.CrCreateFileAction">
            <add-to-group group-id="NewGroup" anchor="before" relative-to-action="NewFile"/>
        </action>
    </actions>
</idea-plugin>