<idea-plugin>
    <id>intellij-crystal-lang</id>
    <name>Crystal</name>
    <vendor email="alexey.sedunov@gmail.com">Alexey Sedunov</vendor>

    <description><![CDATA[Adds support of the Crystal language:
    <ul>
      <li>Basic syntax highlighting</li>
      <li>Initial formatting support</li>
      <li>File structure view</li>
      <li>Go to Class/Go to Symbol navigation</li>
    </ul>]]></description>

    <change-notes><![CDATA[
    Standard library support:
    <ul>
      <li>Project configuration</li>
      <li>Auto-detection of language version</li>
      <li>Resolution of library files in <code>require</code> expressions</li>
    </ul>]]></change-notes>

    <depends>com.intellij.modules.platform</depends>

    <extensionPoints>
        <extensionPoint qualifiedName="org.crystal.sdkFlavor"
                        interface="org.crystal.intellij.sdk.CrystalSdkFlavor"
                        dynamic="true"/>
    </extensionPoints>

    <extensions defaultExtensionNs="com.intellij">
        <fileType name="Crystal"
                  language="Crystal"
                  implementationClass="org.crystal.intellij.CrystalFileType"
                  fieldName="INSTANCE"
                  extensions="cr"/>
        <lang.parserDefinition language="Crystal"
                               implementationClass="org.crystal.intellij.parser.CrystalParserDefinition"/>

        <highlightingPassFactory implementation="org.crystal.intellij.highlighter.CrystalSyntaxHighlightingPass$Factory"/>
        <highlightingPassFactory implementation="org.crystal.intellij.highlighter.CrystalSyntaxCheckingPass$Factory"/>

        <lang.psiStructureViewFactory language="Crystal"
                                      implementationClass="org.crystal.intellij.structure.CrystalStructureViewFactory"/>
        <lang.commenter language="Crystal" implementationClass="org.crystal.intellij.editor.CrystalCommenter"/>
        <lang.foldingBuilder language="Crystal" implementationClass="org.crystal.intellij.editor.CrystalFoldingBuilder"/>
        <lang.elementManipulator forClass="org.crystal.intellij.psi.CrStringLiteralExpression"
                                 implementationClass="org.crystal.intellij.psi.CrStringLiteralManipulator"/>

        <typedHandler implementation="org.crystal.intellij.editor.CrystalTypedHandler"
                      order="before selectionQuoting" />
        <backspaceHandlerDelegate implementation="org.crystal.intellij.editor.CrystalBackspaceHandler"/>
        <enterHandlerDelegate implementation="org.crystal.intellij.editor.CrystalEnterHandler"/>

        <langCodeStyleSettingsProvider implementation="org.crystal.intellij.formatter.CrystalCodeStyleSettingsProvider"/>
        <lang.formatter language="Crystal"
                        implementationClass="org.crystal.intellij.formatter.CrystalFormattingModelBuilder"/>

        <projectService serviceImplementation="org.crystal.intellij.config.CrystalProjectSettings"/>
        <projectService serviceImplementation="org.crystal.intellij.config.CrystalProjectWorkspaceSettings"/>
        <projectService serviceImplementation="org.crystal.intellij.psi.CrPsiFactory"/>

        <projectConfigurable id="crystal.settings"
                             groupId="language"
                             instance="org.crystal.intellij.config.CrystalSettingsConfigurable"/>

        <filePropertyPusher implementation="org.crystal.intellij.config.CrystalLanguageLevelPusher"/>

        <iconProvider implementation="org.crystal.intellij.presentation.CrystalIconProvider"/>

        <elementDescriptionProvider implementation="org.crystal.intellij.presentation.CrystalElementDescriptionProvider"/>

        <stubElementTypeHolder class="org.crystal.intellij.stubs.elementTypes.CrStubElementTypes"/>
        <stubIndex implementation="org.crystal.intellij.stubs.indexes.CrystalTypeShortNameIndex"/>
        <stubIndex implementation="org.crystal.intellij.stubs.indexes.CrystalFunctionShortNameIndex"/>
        <stubIndex implementation="org.crystal.intellij.stubs.indexes.CrystalVariableShortNameIndex"/>

        <additionalLibraryRootsProvider implementation="org.crystal.intellij.sdk.CrystalSdkLibraryRootProvider"/>

        <gotoClassContributor implementation="org.crystal.intellij.navigation.CrystalGotoClassContributor"/>
        <gotoSymbolContributor implementation="org.crystal.intellij.navigation.CrystalGotoSymbolContributor"/>

        <targetElementEvaluator language="Crystal"
                                implementationClass="org.crystal.intellij.navigation.CrystalTargetElementEvaluator"/>

        <localInspection language="Crystal"
                         shortName="CrystalResolveInspection"
                         suppressId="CrystalResolve"
                         bundle="messages.CrystalBundle"
                         key="inspections.resolve.name"
                         groupKey="inspections.group"
                         enabledByDefault="true"
                         level="ERROR"
                         implementationClass="org.crystal.intellij.inspections.CrystalResolveInspection"/>

        <renameHandler implementation="org.crystal.intellij.refactoring.rename.CrystalRenameHandler"/>
    </extensions>

    <extensions defaultExtensionNs="org.crystal">
        <sdkFlavor implementation="org.crystal.intellij.sdk.CrystalUnixSdkFlavor"/>
        <sdkFlavor implementation="org.crystal.intellij.sdk.CrystalWslSdkFlavor"/>
    </extensions>
</idea-plugin>