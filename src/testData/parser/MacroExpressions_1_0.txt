FILE
  CrMacroExpression(CR_MACRO_EXPRESSION)
    PsiElement({{)('{{')
    PsiElement(CR_WHITESPACE)(' ')
    CrIsNilExpression(CR_IS_NIL_EXPRESSION)
      CrReferenceExpression(CR_REFERENCE_EXPRESSION)
        CrSimpleNameElement(CR_SIMPLE_NAME_ELEMENT)
          PsiElement(<identifier>)('foo')
      PsiElement(.)('.')
      PsiElement(nil?)('nil?')
    PsiElement(CR_WHITESPACE)(' ')
    PsiElement(}})('}}')

  CrMacroExpression(CR_MACRO_EXPRESSION)
    PsiElement({{)('{{')
    PsiElement(CR_WHITESPACE)(' ')
    CrCallExpression(CR_CALL_EXPRESSION)
      CrSimpleNameElement(CR_SIMPLE_NAME_ELEMENT)
        PsiElement(<identifier>)('foo')
      PsiElement(CR_WHITESPACE)(' ')
      CrArgumentList(CR_SPACED_ARGUMENT_LIST)
        CrShortBlockArgument(CR_SHORT_BLOCK_ARGUMENT)
          PsiElement(&)('&')
          PsiElement(<synthetic arg: 0>)
            <empty list>
          CrIsNilExpression(CR_IS_NIL_EXPRESSION)
            PsiElement(.)('.')
            PsiElement(nil?)('nil?')
    PsiElement(CR_WHITESPACE)(' ')
    PsiElement(}})('}}')

  CrMacroExpression(CR_MACRO_EXPRESSION)
    PsiElement({{)('{{')
    PsiElement(CR_WHITESPACE)(' ')
    CrIsNilExpression(CR_IS_NIL_EXPRESSION)
      CrReferenceExpression(CR_REFERENCE_EXPRESSION)
        CrSimpleNameElement(CR_SIMPLE_NAME_ELEMENT)
          PsiElement(<identifier>)('foo')
      PsiElement(.)('.')
      PsiElement(nil?)('nil?')
      PsiElement(()('(')
      PsiErrorElement:Expected: ')'
        PsiElement(<identifier>)('foo')
      PsiElement())(')')
    PsiElement(CR_WHITESPACE)(' ')
    PsiElement(}})('}}')

  CrMacroExpression(CR_MACRO_EXPRESSION)
    PsiElement({{)('{{')
    PsiElement(CR_WHITESPACE)(' ')
    CrIsNilExpression(CR_IS_NIL_EXPRESSION)
      PsiElement(nil?)('nil?')
      PsiElement(()('(')
      PsiErrorElement:Expected: ')'
        PsiElement(<identifier>)('foo')
      PsiElement())(')')
    PsiElement(CR_WHITESPACE)(' ')
    PsiElement(}})('}}')

  CrMacro(CR_MACRO_DEFINITION)
    PsiElement(macro)('macro')
    PsiElement(CR_WHITESPACE)(' ')
    CrSimpleNameElement(CR_SIMPLE_NAME_ELEMENT)
      PsiElement(<identifier>)('mmm')
    PsiElement(CR_NEWLINE)('\n')
    CrMacroLiteral(CR_MACRO_LITERAL)
      PsiElement(<macro fragment>)('  macro foo(name)\n    ')
      PsiElement(<macro fragment>)('# some comments \')
      CrMacroExpression(CR_MACRO_EXPRESSION)
        PsiElement({{)('{{')
        PsiElement(CR_WHITESPACE)(' ')
        CrCallExpression(CR_CALL_EXPRESSION)
          CrReferenceExpression(CR_REFERENCE_EXPRESSION)
            CrSimpleNameElement(CR_SIMPLE_NAME_ELEMENT)
              PsiElement(<identifier>)('name')
          PsiElement(.)('.')
          CrSimpleNameElement(CR_SIMPLE_NAME_ELEMENT)
            PsiElement(<identifier>)('id')
        PsiElement(CR_WHITESPACE)(' ')
        PsiElement(}})('}}')
      PsiElement(<macro fragment>)('\n')
      PsiElement(<macro fragment>)('  ')
      PsiElement(<macro fragment>)('end\n  macro bar(name)\n    ')
      PsiElement(<macro fragment>)('# some comments \a')
      PsiElement(<macro fragment>)('\n')
      PsiElement(<macro fragment>)('  ')
      PsiElement(<macro fragment>)('end\n')
    PsiElement(end)('end')