FILE
  CrMacroExpression(CR_MACRO_EXPRESSION)
    PsiElement({{)('{{')
    PsiWhiteSpace(' ')
    CrIsNilExpression(CR_IS_NIL_EXPRESSION)
      CrReferenceExpression(CR_REFERENCE_EXPRESSION)
        CrSimpleNameElement(CR_SIMPLE_NAME_ELEMENT)
          PsiElement(<identifier>)('foo')
      PsiElement(.)('.')
      PsiElement(nil?)('nil?')
    PsiWhiteSpace(' ')
    PsiElement(}})('}}')

  CrMacroExpression(CR_MACRO_EXPRESSION)
    PsiElement({{)('{{')
    PsiWhiteSpace(' ')
    CrCallExpression(CR_CALL_EXPRESSION)
      CrSimpleNameElement(CR_SIMPLE_NAME_ELEMENT)
        PsiElement(<identifier>)('foo')
      PsiWhiteSpace(' ')
      CrArgumentList(CR_SPACED_ARGUMENT_LIST)
        CrShortBlockArgument(CR_SHORT_BLOCK_ARGUMENT)
          PsiElement(&)('&')
          CrIsNilExpression(CR_IS_NIL_EXPRESSION)
            PsiElement(.)('.')
            PsiElement(nil?)('nil?')
    PsiWhiteSpace(' ')
    PsiElement(}})('}}')

  CrMacroExpression(CR_MACRO_EXPRESSION)
    PsiElement({{)('{{')
    PsiWhiteSpace(' ')
    CrIsNilExpression(CR_IS_NIL_EXPRESSION)
      CrReferenceExpression(CR_REFERENCE_EXPRESSION)
        CrSimpleNameElement(CR_SIMPLE_NAME_ELEMENT)
          PsiElement(<identifier>)('foo')
      PsiElement(.)('.')
      PsiElement(nil?)('nil?')
      PsiElement(()('(')
      PsiErrorElement:Expected: ')'
        PsiElement(<identifier>)('foo')
      PsiElement())(')')
    PsiWhiteSpace(' ')
    PsiElement(}})('}}')

  CrMacroExpression(CR_MACRO_EXPRESSION)
    PsiElement({{)('{{')
    PsiWhiteSpace(' ')
    CrIsNilExpression(CR_IS_NIL_EXPRESSION)
      PsiElement(nil?)('nil?')
      PsiElement(()('(')
      PsiErrorElement:Expected: ')'
        PsiElement(<identifier>)('foo')
      PsiElement())(')')
    PsiWhiteSpace(' ')
    PsiElement(}})('}}')

  CrMacro(CR_MACRO_DEFINITION)
    PsiElement(macro)('macro')
    PsiWhiteSpace(' ')
    CrSimpleNameElement(CR_SIMPLE_NAME_ELEMENT)
      PsiElement(<identifier>)('mmm')
    PsiWhiteSpace('\n')
    CrMacroLiteral(CR_MACRO_LITERAL)
      PsiElement(<macro fragment>)('  macro foo(name)\n    ')
      PsiElement(<macro fragment>)('# some comments \')
      CrMacroExpression(CR_MACRO_EXPRESSION)
        PsiElement({{)('{{')
        PsiWhiteSpace(' ')
        CrReferenceExpression(CR_REFERENCE_EXPRESSION)
          CrReferenceExpression(CR_REFERENCE_EXPRESSION)
            CrSimpleNameElement(CR_SIMPLE_NAME_ELEMENT)
              PsiElement(<identifier>)('name')
          PsiElement(.)('.')
          CrSimpleNameElement(CR_SIMPLE_NAME_ELEMENT)
            PsiElement(<identifier>)('id')
        PsiWhiteSpace(' ')
        PsiElement(}})('}}')
      PsiElement(<macro fragment>)('\n')
      PsiElement(<macro fragment>)('  ')
      PsiElement(<macro fragment>)('end\n  macro bar(name)\n    ')
      PsiElement(<macro fragment>)('# some comments \a')
      PsiElement(<macro fragment>)('\n')
      PsiElement(<macro fragment>)('  ')
      PsiElement(<macro fragment>)('end\n')
    PsiElement(end)('end')